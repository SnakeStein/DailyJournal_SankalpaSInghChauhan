<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SecureDailyJournal.ViewModels"
             x:Class="SecureDailyJournal.Views.CalendarPage"
             Title="Calendar">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding AppearingCommand}"
                                        xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"/>
    </ContentPage.Behaviors>

    <Grid RowDefinitions="Auto, *">
        <!-- Header -->
        <Grid ColumnDefinitions="Auto, *, Auto" Padding="20">
            <Button Text="&lt;" Command="{Binding PrevMonthCommand}" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=Black, Dark=White}" FontSize="20"/>
            <Label Text="{Binding MonthName}" FontSize="20" FontAttributes="Bold" HorizontalOptions="Center" VerticalOptions="Center" Grid.Column="1"/>
            <Button Text="&gt;" Command="{Binding NextMonthCommand}" BackgroundColor="Transparent" TextColor="{AppThemeBinding Light=Black, Dark=White}" FontSize="20" Grid.Column="2"/>
        </Grid>

        <!-- Calendar Grid -->
        <CollectionView Grid.Row="1" ItemsSource="{Binding Days}">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" Span="7" HorizontalItemSpacing="5" VerticalItemSpacing="5"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="5" HeightRequest="80">
                         <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CalendarViewModel}}, Path=DayTappedCommand}" CommandParameter="{Binding .}"/>
                        </Grid.GestureRecognizers>
                        
                        <Border StrokeShape="RoundRectangle 10" 
                                BackgroundColor="{AppThemeBinding Light=White, Dark=#374151}"
                                Opacity="{Binding IsCurrentMonth, Converter={StaticResource BoolToOpacityConverter}}"> <!-- Assuming converter or just ignore opacity -->
                                <!-- Let's remove Opacity binding for simplicity directly and use triggers if needed, but simple is fine -->
                            <Grid>
                                <Label Text="{Binding DisplayText}" 
                                       HorizontalOptions="Center" 
                                       VerticalOptions="Center" 
                                       FontSize="16"
                                       TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
                                
                                <BoxView HeightRequest="8" WidthRequest="8" 
                                         CornerRadius="4" 
                                         Color="{Binding IndicatorColor}" 
                                         VerticalOptions="End" 
                                         HorizontalOptions="Center" 
                                         Margin="0,0,0,10"/>
                            </Grid>
                        </Border>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>

</ContentPage>
