<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:SecureDailyJournal.ViewModels"
             x:Class="SecureDailyJournal.Views.CalendarPage"
             Title="Calendar">

    <ContentPage.Behaviors>
        <toolkit:EventToCommandBehavior EventName="Appearing" Command="{Binding AppearingCommand}"
                                        xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"/>
    </ContentPage.Behaviors>

    <Grid RowDefinitions="Auto, Auto, *">
        <!-- Header -->
        <Grid ColumnDefinitions="*, Auto" Padding="20,20,20,10">
            <Label Text="{Binding MonthName}" FontSize="24" FontAttributes="Bold" VerticalOptions="Center" TextColor="{AppThemeBinding Light=Black, Dark=White}"/>
            
            <HorizontalStackLayout Grid.Column="1" Spacing="15">
                <Button Text="&#xE72B;" FontFamily="Segoe MDL2 Assets" 
                        Command="{Binding PrevMonthCommand}" 
                        BackgroundColor="Transparent" 
                        TextColor="Gray" 
                        FontSize="18"
                        WidthRequest="40" HeightRequest="40"/>
                <Button Text="&#xE72A;" FontFamily="Segoe MDL2 Assets" 
                        Command="{Binding NextMonthCommand}" 
                        BackgroundColor="Transparent" 
                        TextColor="Gray" 
                        FontSize="18"
                        WidthRequest="40" HeightRequest="40"/>
            </HorizontalStackLayout>
        </Grid>

        <!-- Weekday Headers -->
        <Grid Grid.Row="1" ColumnDefinitions="*,*,*,*,*,*,*" Padding="10,0" Margin="0,0,0,10">
            <Label Text="S" HorizontalOptions="Center" TextColor="Gray" FontSize="14"/>
            <Label Text="M" HorizontalOptions="Center" TextColor="Gray" FontSize="14" Grid.Column="1"/>
            <Label Text="T" HorizontalOptions="Center" TextColor="Gray" FontSize="14" Grid.Column="2"/>
            <Label Text="W" HorizontalOptions="Center" TextColor="Gray" FontSize="14" Grid.Column="3"/>
            <Label Text="T" HorizontalOptions="Center" TextColor="Gray" FontSize="14" Grid.Column="4"/>
            <Label Text="F" HorizontalOptions="Center" TextColor="Gray" FontSize="14" Grid.Column="5"/>
            <Label Text="S" HorizontalOptions="Center" TextColor="Gray" FontSize="14" Grid.Column="6"/>
        </Grid>

        <!-- Calendar Grid -->
        <CollectionView Grid.Row="2" ItemsSource="{Binding Days}">
            <CollectionView.ItemsLayout>
                <GridItemsLayout Orientation="Vertical" Span="7" HorizontalItemSpacing="5" VerticalItemSpacing="5"/>
            </CollectionView.ItemsLayout>
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Grid Padding="2" HeightRequest="50" WidthRequest="50">
                         <Grid.GestureRecognizers>
                            <TapGestureRecognizer Command="{Binding Source={RelativeSource AncestorType={x:Type vm:CalendarViewModel}}, Path=DayTappedCommand}" CommandParameter="{Binding .}"/>
                        </Grid.GestureRecognizers>
                        
                        <Border StrokeShape="RoundRectangle 25" 
                                StrokeThickness="0"
                                BackgroundColor="{Binding BackgroundColor}"
                                HeightRequest="50"
                                WidthRequest="50"
                                HorizontalOptions="Center"
                                VerticalOptions="Center">
                            <Label Text="{Binding DisplayText}" 
                                   HorizontalOptions="Center" 
                                   VerticalOptions="Center" 
                                   FontSize="14"
                                   TextColor="{Binding TextColor}"/>
                        </Border>
                    </Grid>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </Grid>

</ContentPage>
